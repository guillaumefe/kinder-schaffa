<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kinder Schaffa</title>

  <style>
    :root{
      --bg:#f7fbff;
      --card:#ffffff;
      --stroke:#dbe6ff;
      --text:#1f2937;
      --muted:#6b7280;

      --blue:#3b82f6;
      --green:#22c55e;
      --orange:#f59e0b;
      --red:#ef4444;

      --shadow:0 18px 40px rgba(59,130,246,.16);
      --r:24px;
      --r2:16px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: var(--bg);
      display:grid;
      place-items:center;
      padding:22px;
      color:var(--text);
    }

    .app{
      width:min(900px,100%);
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    header{
      padding:18px 20px;
      border-bottom:1px solid var(--stroke);
      display:flex;
      align-items:center;
      gap:14px;
    }

    .logo{
      width:52px;height:52px;
      border-radius:18px;
      background:var(--green);
      display:grid;
      place-items:center;
      font-size:26px;
    }

    main{padding:20px}

    label{font-weight:800}

    .row{
      display:flex;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }

    input{
      flex:1;
      padding:14px;
      border-radius:var(--r2);
      border:2px solid var(--stroke);
      font-size:16px;
      min-width:240px;
    }

    button{
      padding:14px 18px;
      border-radius:var(--r2);
      border:none;
      background:var(--green);
      font-weight:900;
      cursor:pointer;
    }

    .panel{
      margin-top:20px;
      border:2px dashed var(--stroke);
      border-radius:var(--r);
      padding:18px;
      background:#fbfdff;
    }

    .badge{
      display:inline-flex;
      padding:10px 14px;
      border-radius:999px;
      font-weight:900;
      border:2px solid var(--stroke);
    }

    .ok{background:#ecfdf5;color:#166534}
    .ko{background:#fff7ed;color:#9a3412}
    .err{background:#fef2f2;color:#991b1b}
    .load{background:#eff6ff;color:#1d4ed8}

    .text{margin-top:12px;color:var(--muted)}

    .card{
      margin-top:14px;
      border:1px solid var(--stroke);
      border-radius:16px;
      padding:12px;
      background:#fff;
    }

    .k{font-size:12px;color:var(--muted);font-weight:800}
    .v{font-size:14px;font-weight:800;white-space:pre-line}

    .btnLink{
      display:inline-flex;
      margin-top:6px;
      padding:10px 14px;
      background:var(--blue);
      color:white;
      border-radius:14px;
      text-decoration:none;
      font-weight:900;
    }

    .choiceWrap{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
    }

    .choiceBtn{
      background:var(--blue);
      color:#fff;
      border:none;
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:900;
      font-size:14px;
    }

    footer{
      padding:14px;
      border-top:1px solid var(--stroke);
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
  </style>
</head>

<body>
<div class="app">
<header>
  <div class="logo">ðŸ§¸</div>
  <div>
    <h1>Kinder Schaffa</h1>
    <div style="color:#6b7280;font-size:14px">
      Apprendre Ã  vÃ©rifier les informations
    </div>
  </div>
</header>

<main>
  <label for="org">Nom de lâ€™entreprise ou organisation</label>
  <div class="row">
    <input id="org" placeholder="Ex : Nike, LEGO, Nintendoâ€¦" />
    <button id="btn">ðŸ”Ž Chercher</button>
  </div>

  <div class="panel">
    <div id="help">
      <div class="badge">Informations</div>
      <p class="text">
        Saisis le nom dâ€™une entreprise ou organisation, puis lance la recherche.
        Lâ€™analyse porte uniquement sur la section <b>Controverse</b> de WikipÃ©dia
        et recherche les mots <b>travail</b> et <b>enfants</b>.
      </p>
    </div>

    <div id="result" style="display:none">
      <div class="badge" id="badge"></div>
      <p class="text" id="msg"></p>

      <div class="card" id="choicesCard" style="display:none">
        <div class="k">SÃ©lection de page</div>
        <div class="choiceWrap" id="choices"></div>
      </div>

      <div class="card">
        <div class="k">Page WikipÃ©dia</div>
        <div class="v" id="title"></div>
        <a class="btnLink" id="wikiLink" target="_blank" rel="noopener noreferrer">
          Ouvrir la page
        </a>
      </div>

      <div class="card">
        <div class="k">RÃ©sumÃ©</div>
        <div class="v" id="summary"></div>
      </div>

      <div class="card">
        <div class="k">RÃ©sultat</div>
        <div class="v" id="resultText"></div>
      </div>
    </div>
  </div>
</main>

<footer>
  <span>Kinder Schaffa</span>
  <span id="api">API :</span>
  <span id="auth">Auth :</span>
</footer>
</div>

<script>
function _cs(a){ return String.fromCharCode(...a); }

function buildApiBase(){
  const proto = _cs([104,116,116,112,115,58,47,47]);
  const uuid = _cs([
    98,99,54,99,97,55,102,53,45,57,99,51,48,45,52,57,
    102,54,45,97,56,101,56,45,48,49,99,50,54,97,49,101,
    56,57,97,100
  ]);
  const suffix = _cs([46,102,114,101,101,100,100,110,115,46,111,114,103]);
  return proto + uuid + suffix;
}

function buildApiToken(){
  const TOKEN_CHARCODES = [
    50, 54, 56, 50, 53, 57, 101, 50, 102, 97, 52, 101, 48, 55, 99, 50, 97, 56, 48, 
    57, 48, 102, 98, 51, 56, 57, 57, 54, 49, 100, 97, 55, 101, 57, 100, 99, 101, 51, 
    102, 51, 101, 49, 50, 57, 101, 99, 100, 49, 52, 55, 53, 56, 48, 51, 49, 98, 51, 
    53, 57, 51, 101, 48, 50, 101
  ];
  return _cs(TOKEN_CHARCODES);
}

const API_BASE = buildApiBase();
const API_TOKEN = buildApiToken();

document.getElementById("api").textContent = "API : " + API_BASE + "/check";
document.getElementById("auth").textContent = "Auth : Bearer";

const btn = document.getElementById("btn");
const input = document.getElementById("org");

const help = document.getElementById("help");
const result = document.getElementById("result");

const badge = document.getElementById("badge");
const msg = document.getElementById("msg");
const title = document.getElementById("title");
const wikiLink = document.getElementById("wikiLink");
const summary = document.getElementById("summary");
const resultText = document.getElementById("resultText");

const choicesCard = document.getElementById("choicesCard");
const choices = document.getElementById("choices");

function wikiSearch(org){
  return "https://fr.wikipedia.org/wiki/Special:Search?search=" +
    encodeURIComponent(org);
}

function buildCheckUrl(org, pick){
  const qs = pick
    ? `org=${encodeURIComponent(org)}&pick=${encodeURIComponent(pick)}`
    : `org=${encodeURIComponent(org)}`;
  return `${API_BASE}/check?${qs}`;
}

function resetUI(){
  badge.className = "badge load";
  badge.textContent = "Recherche en cours";
  msg.textContent = "Analyse de la section Controverse";
  summary.textContent = "";
  resultText.textContent = "";
  choicesCard.style.display = "none";
  choices.innerHTML = "";
}

function showChoices(org, list){
  choicesCard.style.display = "block";
  list.forEach(c => {
    const b = document.createElement("button");
    b.className = "choiceBtn";
    b.textContent = c;
    b.onclick = async () => {
      resetUI();
      const data = await callApi(org, c);
      render(data, org);
    };
    choices.appendChild(b);
  });
}

async function callApi(org, pick){
  let res;
  try{
    res = await fetch(buildCheckUrl(org, pick), {
      method:"GET",
      headers:{ Authorization:"Bearer " + API_TOKEN },
      cache:"no-store"
    });
  }catch(e){
    return { ok:false, message:"Erreur rÃ©seau ou CORS" };
  }

  let data = null;
  try{ data = await res.json(); }catch(e){}

  if (!res.ok){
    return data || { ok:false, message:"Erreur API (" + res.status + ")" };
  }
  return data;
}

function render(data, org){
  if (!data || data.ok === false){
    badge.className = "badge err";
    badge.textContent = "Erreur";
    msg.textContent = data?.message || "Erreur";
    title.textContent = org;
    wikiLink.href = wikiSearch(org);
    return;
  }

  title.textContent = data.title || org;
  wikiLink.href = data.wikipedia || wikiSearch(org);
  summary.textContent = data.summary || "";
  msg.textContent = data.message || "";

  if (data.homonymyDetected && data.needChoice){
    badge.className = "badge err";
    badge.textContent = "Homonymie";
    resultText.textContent = "SÃ©lection requise";
    showChoices(org, data.homonymyCandidates || []);
    return;
  }

  if (data.childLabor === true){
    badge.className = "badge ko";
    badge.textContent = "Signal dÃ©tectÃ©";
    resultText.textContent = "Mots clÃ©s dÃ©tectÃ©s dans la section Controverse.";
  }else if (data.childLabor === false){
    badge.className = "badge ok";
    badge.textContent = "Aucun signal dÃ©tectÃ©";
    resultText.textContent = "Aucun indicateur trouvÃ© dans la section Controverse.";
  }else{
    badge.className = "badge err";
    badge.textContent = "IndÃ©terminÃ©";
    resultText.textContent = data.message || "";
  }
}

btn.onclick = async () => {
  const org = input.value.trim();
  if (!org){
    help.style.display = "block";
    result.style.display = "none";
    return;
  }

  help.style.display = "none";
  result.style.display = "block";
  resetUI();

  const data = await callApi(org);
  render(data, org);
};

input.addEventListener("keydown", e => {
  if (e.key === "Enter") btn.click();
});
</script>
</body>
</html>
